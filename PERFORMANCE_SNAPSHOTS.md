# 🚀 Performance Snapshots & CI Integration

This document explains how to use the new performance snapshot capabilities and CI integration features of React Performance Analyzer, similar to tools like [reassure](https://github.com/callstack/reassure).

## 📸 Performance Snapshots

Performance snapshots allow you to capture the current state of your codebase's performance metrics and compare them over time to detect regressions.

### Creating Snapshots

```bash
# Create a snapshot of the current codebase
npx react-performanalyzer ci --output json

# Create a baseline snapshot (typically on main branch)
npx react-performanalyzer ci --output json,github-comment
```

### Snapshot Structure

Each snapshot contains:

```json
{
  "id": "snapshot-1234567890-abc123",
  "timestamp": 1234567890,
  "branch": "feature/new-component",
  "commit": "abc123def456",
  "metrics": {
    "totalFiles": 25,
    "totalIssues": 15,
    "highSeverityIssues": 3,
    "mediumSeverityIssues": 8,
    "lowSeverityIssues": 4,
    "averageScore": 85.5,
    "performanceScore": 90.2,
    "memoryScore": 88.7,
    "codeQualityScore": 82.1
  },
  "fileAnalysis": [...],
  "environment": {
    "nodeVersion": "v18.17.0",
    "packageVersion": "0.0.6",
    "os": "darwin"
  }
}
```

## 🔄 Snapshot Comparison

The system automatically compares current snapshots against baselines to detect:

- **Performance Regressions**: Score decreases above threshold
- **Issue Increases**: More high/medium severity issues
- **File-level Changes**: Which specific files got worse/better

### Comparison Example

```bash
# Compare against main branch baseline
npx react-performanalyzer ci --baseline-branch main

# Custom thresholds
npx react-performanalyzer ci \
  --max-score-regression 3 \
  --max-high-severity-increase 1 \
  --max-total-issues-increase 5
```

## 🚨 PR Alerts

The system generates comprehensive PR alerts that include:

### Alert Types

1. **Critical Issues** (Block PR)
   - Score regression > threshold
   - High severity issues increase > threshold
   - Total issues increase > threshold

2. **Warnings** (Allow PR with warning)
   - Minor score regressions
   - Files with performance issues

3. **Improvements** (Highlight positive changes)
   - Score improvements
   - Reduced issues

### GitHub Comment Example

```markdown
## 🚀 React Performance Check ✅

**Status:** PASSED  
**Score:** 92/100

### ✅ Improvements
- Performance score improved by 3.2 points
- 5 files show improvements

### 📊 Metrics
- Files with regressions: 0
- Files with improvements: 5
- Unchanged files: 20

---
*Generated by React Performance Analyzer for PR #123*
```

## 🔧 CI/CD Integration

### GitHub Actions Workflow

The included workflow (`.github/workflows/performance-check.yml`) automatically:

1. **On Main Branch**: Creates baseline snapshots
2. **On PRs**: Compares against baseline and generates alerts
3. **Blocks PRs**: If critical regressions detected
4. **Posts Comments**: Detailed performance report on PR

### Workflow Features

- ✅ Automatic baseline creation
- ✅ PR regression detection
- ✅ GitHub comment integration
- ✅ Artifact upload for reports
- ✅ Configurable thresholds
- ✅ Multiple output formats

### Manual CI Usage

```bash
# Basic CI check
npx react-performanalyzer ci

# Custom configuration
npx react-performanalyzer ci \
  --baseline-branch develop \
  --output console,json,github-comment \
  --max-score-regression 10 \
  --no-fail-on-regression
```

## 📊 Configuration Options

### Thresholds

| Option | Default | Description |
|--------|---------|-------------|
| `--max-score-regression` | 5 | Maximum allowed score decrease |
| `--max-high-severity-increase` | 2 | Max high severity issues increase |
| `--max-total-issues-increase` | 10 | Max total issues increase |
| `--min-score-improvement` | 2 | Min score improvement to highlight |

### Output Formats

- `console`: Terminal output with colors
- `json`: Machine-readable JSON report
- `github-comment`: Markdown for GitHub comments

### CI Behavior

- `--no-fail-on-regression`: Don't fail CI on regressions
- `--no-warn-on-regression`: Don't show warnings
- `--baseline-branch`: Branch to compare against

## 🏗️ Advanced Usage

### Programmatic API

```typescript
import { 
  PerformanceSnapshotManager, 
  PRAlertSystem 
} from 'react-performanalyzer'

// Create snapshot manager
const snapshotManager = new PerformanceSnapshotManager('.snapshots')

// Create snapshot
const snapshot = await snapshotManager.createSnapshot(
  analyses,
  'feature-branch',
  'abc123'
)

// Generate alerts
const alertSystem = new PRAlertSystem('.snapshots', {
  maxScoreRegression: 5,
  maxHighSeverityIncrease: 2
})

const report = await alertSystem.generateAlertReport(snapshot, 'main')
alertSystem.printAlertReport(report)
```

### Custom Thresholds

```typescript
const thresholds = {
  maxScoreRegression: 3,        // Stricter regression detection
  maxHighSeverityIncrease: 1,   // Very sensitive to high severity
  maxTotalIssuesIncrease: 5,    // Moderate tolerance for total issues
  minScoreImprovement: 5        // Highlight significant improvements
}
```

### Snapshot Management

```typescript
// List all snapshots
const snapshots = await snapshotManager.listSnapshots()

// Load specific snapshot
const snapshot = await snapshotManager.loadSnapshot('snapshot-id')

// Clean up old snapshots (older than 7 days)
await snapshotManager.cleanupOldSnapshots(7 * 24 * 60 * 60 * 1000)
```

## 🔍 Monitoring & Analytics

### Snapshot Storage

Snapshots are stored in `.performance-snapshots/`:
```
.performance-snapshots/
├── snapshot-1234567890-abc123.json
├── snapshot-1234567891-def456.json
├── baselines/
│   ├── baseline-main.json
│   └── baseline-develop.json
├── report-snapshot-id.json
└── comment-snapshot-id.md
```

### Metrics Tracking

Track these key metrics over time:

- **Average Score**: Overall performance health
- **High Severity Issues**: Critical problems
- **File Count**: Codebase size
- **Score Breakdown**: Performance, Memory, Code Quality

### Integration with Monitoring Tools

The JSON reports can be integrated with:

- **Datadog**: Custom metrics
- **Grafana**: Performance dashboards
- **Sentry**: Performance monitoring
- **Custom dashboards**: Internal tools

## 🚀 Best Practices

### 1. Baseline Management

- Create baselines on stable branches (main/develop)
- Update baselines after major refactoring
- Use different baselines for different environments

### 2. Threshold Configuration

- Start with default thresholds
- Adjust based on team velocity and tolerance
- Consider different thresholds for different branches

### 3. CI Integration

- Run on all PRs
- Block on critical regressions
- Use warnings for minor issues
- Post detailed reports as comments

### 4. Monitoring

- Track trends over time
- Set up alerts for significant regressions
- Review and adjust thresholds regularly
- Celebrate improvements

## 🔧 Troubleshooting

### Common Issues

1. **No baseline found**
   - Create baseline on main branch first
   - Check baseline branch name

2. **Too many false positives**
   - Increase thresholds
   - Review analysis patterns

3. **CI failures**
   - Check threshold configuration
   - Review actual regressions
   - Use `--no-fail-on-regression` for testing

### Debug Mode

```bash
# Verbose output
npx react-performanalyzer ci --verbose

# Save detailed logs
npx react-performanalyzer ci --output json --debug
```

## 📈 Future Enhancements

Planned features:

- [ ] **Trend Analysis**: Historical performance tracking
- [ ] **Custom Metrics**: Project-specific performance indicators
- [ ] **Integration APIs**: Webhook support for external tools
- [ ] **Dashboard**: Web-based performance monitoring
- [ ] **Team Analytics**: Performance by developer/team
- [ ] **Automated Fixes**: AI-powered code improvements

---

For more information, see the [main README](../README.md) or [open an issue](https://github.com/mohamadgarmabi/react-performanalyzer/issues). 